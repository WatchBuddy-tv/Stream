{% extends "_html_taban.html.j2" %}


{% block breadcrumbs %}
<nav class="breadcrumbs">
    <div class="breadcrumbs-item">
        <a href="/" class="breadcrumbs-link"><i class="fas fa-home"></i> <span data-i18n="nav_home">{{ tr('nav_home') }}</span></a>
    </div>
    <div class="breadcrumbs-item">
        <a href="/eklenti/{{ eklenti_adi }}{{ provider_query }}" class="breadcrumbs-link">{{ provider_name }} - {{ eklenti_adi }}</a>
    </div>
    <div class="breadcrumbs-item">
        <span class="breadcrumbs-current"><i class="fas fa-play"></i> {{ baslik }}</span>
    </div>
</nav>
{% endblock %}


{% block icerik %}

<div class="detail-container">
    <div class="player-header">
        <h1 class="player-title"><i class="fas fa-play-circle"></i> {{ baslik }}</h1>
    </div>

    <div class="source-selection">
        <h3><i class="fas fa-server"></i> <span data-i18n="sources_title">{{ tr('sources_title') }}</span></h3>
        <div id="video-links-ui" class="source-list"></div>
    </div>

    <div id="video-player-container">
        <div id="video-player-wrapper">
            <div id="loading-overlay" class="player-loading" style="display: none;">
                <div class="player-message">
                    <div class="wp-spinner"></div>
                </div>
            </div>
            <video id="video-player" playsinline webkit-playsinline crossorigin="anonymous">
                <span data-i18n="browser_video_unsupported">{{ tr('browser_video_unsupported') }}</span>
            </video>

            <!-- Firefox Custom Subtitle Overlay -->
            <div id="custom-subtitle-overlay" class="custom-subtitle-overlay"></div>

            <!-- Netflix Style Custom Controls -->
            <div class="video-controls-overlay">
                <!-- Action Animation -->
                <div class="action-animation" id="action-animation">
                    <i class="fas fa-play"></i>
                </div>



                <!-- Bottom Controls -->
                <div class="bottom-controls">
                    <!-- Progress Slider -->
                    <div class="progress-container" id="custom-progress-container">
                        <div class="progress-bar-fill" id="custom-progress-fill">
                            <div class="progress-handle"></div>
                        </div>
                    </div>

                    <div class="control-row">
                        <div class="control-group">
                            <button class="ctrl-btn" id="bottom-play-pause" title="{{ tr('tooltip_play_pause') }}" data-i18n="tooltip_play_pause" data-i18n-attr="title">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="ctrl-btn" id="custom-backward" title="{{ tr('tooltip_rewind') }}" data-i18n="tooltip_rewind" data-i18n-attr="title">
                                <i class="fas fa-undo"></i>
                            </button>
                            <button class="ctrl-btn" id="custom-forward" title="{{ tr('tooltip_forward') }}" data-i18n="tooltip_forward" data-i18n-attr="title">
                                <i class="fas fa-redo"></i>
                            </button>

                            <!-- Volume -->
                            <div class="volume-group">
                                <button class="ctrl-btn" id="custom-mute" title="{{ tr('tooltip_mute') }}" data-i18n="tooltip_mute" data-i18n-attr="title">
                                    <i class="fas fa-volume-up"></i>
                                </button>
                                <input type="range" id="custom-volume-slider" class="volume-slider" min="0" max="1" step="0.01" value="1">
                            </div>

                            <!-- Time -->
                            <div class="time-display">
                                <span id="current-time">0:00</span> / <span id="duration-time">0:00</span>
                            </div>
                        </div>

                        <div class="control-group">
                            <button class="ctrl-btn" id="custom-audio" style="display: none;" title="{{ tr('tooltip_audio') }}" data-i18n="tooltip_audio" data-i18n-attr="title">
                                <i class="fas fa-headphones-alt"></i>
                            </button>
                            <button class="ctrl-btn" id="custom-cc" style="display: none;" title="{{ tr('tooltip_subtitle') }}" data-i18n="tooltip_subtitle" data-i18n-attr="title">
                                <i class="fas fa-closed-captioning"></i>
                            </button>
                            <button class="ctrl-btn" id="custom-fullscreen" title="{{ tr('tooltip_fullscreen') }}" data-i18n="tooltip_fullscreen" data-i18n-attr="title">
                                <i class="fas fa-expand"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="player-controls-section">
        <div class="control-buttons">
            {% if icerik_url %}
            <a href="/icerik/{{ eklenti_adi }}?url={{ icerik_url }}{{ provider_query_amp }}" class="button button-secondary">
                <i class="fas fa-arrow-left"></i> <span data-i18n="player_back_content">{{ tr('player_back_content') }}</span>
            </a>
            {% endif %}
            <a href="/eklenti/{{ eklenti_adi }}{{ provider_query }}" class="button button-secondary">
                <i class="fas fa-th"></i> <span data-i18n="player_back_plugin">{{ tr('player_back_plugin') }}</span>
            </a>
            <button id="toggle-diagnostics" class="button button-secondary">
                <i class="fas fa-bug"></i> <span data-i18n="diagnostics_button">{{ tr('diagnostics_button') }}</span>
            </button>
            <a href="#" target="_blank" id="watch-party-button" class="button button-secondary">
                <i class="fas fa-users"></i> <span data-i18n="watchbuddy_web">{{ tr('watchbuddy_web') }}</span>
            </a>
            <a href="#" id="watch-party-app-button" class="button button-secondary" style="display: none;">
                <i class="fas fa-mobile-alt"></i> <span data-i18n="watchbuddy_app">{{ tr('watchbuddy_app') }}</span>
            </a>
        </div>
    </div>

    <div id="diagnostics-panel">
        <div class="diagnostics-header">
            <h3 data-i18n="diagnostics_title">{{ tr('diagnostics_title') }}</h3>
            <div class="diagnostics-toolbar">
                <button id="clear-logs" class="button button-diagnostic" data-i18n="diagnostics_clear">{{ tr('diagnostics_clear') }}</button>
                <button id="copy-logs" class="button button-diagnostic" data-i18n="diagnostics_copy">{{ tr('diagnostics_copy') }}</button>
                <button id="download-logs" class="button button-diagnostic" data-i18n="diagnostics_download">{{ tr('diagnostics_download') }}</button>
            </div>
        </div>
        <pre id="diagnostics-log"></pre>
    </div>

    <div id="video-links-data" style="display: none;"
         data-proxy-url="{{ proxy_url|default('', true) }}"
         data-proxy-fallback-url="{{ proxy_fallback_url|default('', true) }}">
        {% for link in links %}
            <div class="video-link-item" data-name="{{ link.name }}" data-url="{{ link.url }}" data-referer="{{ link.referer|default('', true) }}" data-user-agent="{{ link.user_agent|default('', true) }}">
                {% for subtitle in link.subtitles %}
                    <div class="subtitle-item" data-name="{{ subtitle.name }}" data-url="{{ subtitle.url }}"></div>
                {% endfor %}
            </div>
        {% endfor %}
    </div>

    <!-- Seçim Dropdown (Altyazı / Ses) -->
    <div id="selection-modal" class="selection-dropdown" style="display: none;">
        <div class="selection-dropdown-header">
            <h3 id="modal-title"><i id="modal-icon" class="fas fa-closed-captioning"></i> <span data-i18n="selection_prompt">{{ tr('selection_prompt') }}</span></h3>
        </div>
        <div class="selection-dropdown-body" id="selection-list">
            <!-- Seçenekler buraya dinamik olarak eklenecek -->
        </div>
    </div>
</div>

{% endblock %}

{% block js %}
    <script type="module" src="{{ url_for('static_home', path='JS/player.min.js') }}" defer crossorigin="anonymous"></script>
{% endblock %}
